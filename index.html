<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Kelvin&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Things need record">
<meta property="og:type" content="website">
<meta property="og:title" content="Kelvin's Blog">
<meta property="og:url" content="http://kevin0431.github.io/index.html">
<meta property="og:site_name" content="Kelvin's Blog">
<meta property="og:description" content="Things need record">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kelvin's Blog">
<meta name="twitter:description" content="Things need record">
  
  
    <link rel="icon" href="/img/avatar.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Kelvin</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Carpe Diem</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/kevin0431" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">某互联网公司运维攻城狮</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Kelvin</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/avatar.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Kelvin</h1>
			</hgroup>
			
			<p class="header-subtitle">Carpe Diem</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/kevin0431" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Centos安全加固总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/15/Centos安全加固总结/" class="article-date">
  	<time datetime="2016-05-15T03:34:41.250Z" itemprop="datePublished">2016-05-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	
	<div id="toc" class="toc-article">
		<strong class="toc-title">文章目录</strong>
	<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Centos安全加固"><span class="toc-number">1.</span> <span class="toc-text">Centos安全加固</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-配置密码不允许重复次数和复杂度"><span class="toc-number">1.1.</span> <span class="toc-text">1. 配置密码不允许重复次数和复杂度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-禁止root登录"><span class="toc-number">1.2.</span> <span class="toc-text">2. 禁止root登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-修改密码长度和过期时间："><span class="toc-number">1.3.</span> <span class="toc-text">3.修改密码长度和过期时间：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-设置连续失败次数和失败锁定时间"><span class="toc-number">1.4.</span> <span class="toc-text">4. 设置连续失败次数和失败锁定时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-umask降权，设置历史命令数"><span class="toc-number">1.5.</span> <span class="toc-text">5. umask降权，设置历史命令数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-修改ssh-banner"><span class="toc-number">1.6.</span> <span class="toc-text">6. 修改ssh banner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-修改ssh访问控制"><span class="toc-number">1.7.</span> <span class="toc-text">7. 修改ssh访问控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-空闲超时退出"><span class="toc-number">1.8.</span> <span class="toc-text">8. 空闲超时退出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-su限制"><span class="toc-number">1.9.</span> <span class="toc-text">9. su限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-取消CTRL-ALT-DELETE"><span class="toc-number">1.10.</span> <span class="toc-text">10. 取消CTRL+ALT+DELETE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-修改motd，登陆系统后的提示信息"><span class="toc-number">1.11.</span> <span class="toc-text">11. 修改motd，登陆系统后的提示信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-禁用不用的用户和组"><span class="toc-number">1.12.</span> <span class="toc-text">12. 禁用不用的用户和组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-禁用没用的服务"><span class="toc-number">1.13.</span> <span class="toc-text">13. 禁用没用的服务</span></a></li></ol></li></ol>
	</div>
	
        <h1 id="Centos安全加固"><a href="#Centos安全加固" class="headerlink" title="Centos安全加固"></a>Centos安全加固</h1><blockquote>
<ul>
<li>要更新的软件：<br>bash，openssl，glibc</li>
</ul>
</blockquote>
<h2 id="1-配置密码不允许重复次数和复杂度"><a href="#1-配置密码不允许重复次数和复杂度" class="headerlink" title="1. 配置密码不允许重复次数和复杂度"></a>1. 配置密码不允许重复次数和复杂度</h2><pre>
#编辑/etc/pam.d/system-auth文件，找到以下行：
password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok
#后面添加  remember=3  代表不允许使用之前3次用过的密码
</pre>

<pre>
#找到以下行
password    requisite     pam_cracklib.so try_first_pass retry=3 type=

修改为：
password    requisite     pam_cracklib.so try_first_pass retry=6 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1
#retry=N 重试N次后返回密码错误
#difok=N 新密码必需与旧密码不同的位数
#dcredit=N N>=0表示密码最多N个数字，反之最少N个数字
#lcredit=N 小写字母个数
#ucredit=N 小写字母个数
#ccredit=N 小写字母个数
#minclass=N 密码组成(大/小字母,数字,特殊字符)
#root不受此限制，普通用户登录后改密码才受限制
</pre>

<h2 id="2-禁止root登录"><a href="#2-禁止root登录" class="headerlink" title="2. 禁止root登录"></a>2. 禁止root登录</h2><pre>
#更改/etc/ssh/sshd_config，之后重启sshd
PermitRootLogin yes
改成：PermitRootLogin no
</pre>

<h2 id="3-修改密码长度和过期时间："><a href="#3-修改密码长度和过期时间：" class="headerlink" title="3.修改密码长度和过期时间："></a>3.修改密码长度和过期时间：</h2><pre>
#改 /etc/login.defs
PASS_MAX_DAYS   90
PASS_MIN_DAYS   1
PASS_MIN_LEN    9
PASS_WARN_AGE   7
解释：
# PASS_MAX_DAYS   密码使用的最长期限
# PASS_MIN_DAYS   密码允许更改的最短期限
# PASS_MIN_LEN    能接受的密码最短长度
# PASS_WARN_AGE   密码过期之前的提醒天数
</pre>

<h2 id="4-设置连续失败次数和失败锁定时间"><a href="#4-设置连续失败次数和失败锁定时间" class="headerlink" title="4. 设置连续失败次数和失败锁定时间"></a>4. 设置连续失败次数和失败锁定时间</h2><p>修改(/etc/pam.d/system-auth和/etc/pam.d/sshd)分别在开始位置加入以下内容：</p>
<pre>
auth    required    pam_tally2.so    deny=6    unlock_time=300    even_deny_root root_unlock_time=120
#最大失败次数6次，超过6次锁定300s，root用户锁定120s
#两个文件中"required pam_tally2.so deny"要删掉
</pre>

<h2 id="5-umask降权，设置历史命令数"><a href="#5-umask降权，设置历史命令数" class="headerlink" title="5. umask降权，设置历史命令数"></a>5. umask降权，设置历史命令数</h2><p>默认uid&gt;199的umask是022，uid&lt;199的umask是022，可以在/etc/profile里新加一行”umask 027”，修改HISSIZE=100，即最大历史命令是100</p>
<h2 id="6-修改ssh-banner"><a href="#6-修改ssh-banner" class="headerlink" title="6. 修改ssh banner"></a>6. 修改ssh banner</h2><p>自定义banner文件：echo “Only Gomeholdings users can login” &gt; /etc/ssh/gomebanner<br>再修改/etc/ssh/sshd_config 新增”Banner /etc/ssh/gomebanner”</p>
<h2 id="7-修改ssh访问控制"><a href="#7-修改ssh访问控制" class="headerlink" title="7. 修改ssh访问控制"></a>7. 修改ssh访问控制</h2><p>/etc/hosts.allow文件<br>如： sshd:10.35.0.0/255.255.0.0<br>禁止访问的文件 /etc/hosts.deny    sshd:all<br>hosts.allow文件优先</p>
<h2 id="8-空闲超时退出"><a href="#8-空闲超时退出" class="headerlink" title="8. 空闲超时退出"></a>8. 空闲超时退出</h2><p>改/etc/profile 追加 TMOUT=300</p>
<h2 id="9-su限制"><a href="#9-su限制" class="headerlink" title="9. su限制"></a>9. su限制</h2><p>修改/etc/login.defs 追加”SU_WHEEL_ONLY yes”<br>修改/etc/pam.d/su<br>将”auth        required    pam_wheel.so use_uid”取消注释<br>将要配置su权限的用户加到wheel组：<br>usermod -G wheel work</p>
<h2 id="10-取消CTRL-ALT-DELETE"><a href="#10-取消CTRL-ALT-DELETE" class="headerlink" title="10. 取消CTRL+ALT+DELETE"></a>10. 取消CTRL+ALT+DELETE</h2><p>修改/etc/init/control-alt-delete.conf，注释掉以下内容：<br>start on control-alt-delete<br>exec /sbin/shutdown -r now “Control-Alt-Delete pressed”</p>
<p>对于Centos7只需：rm -rf /usr/lib/systemd/ctrl-alt-del.target</p>
<h2 id="11-修改motd，登陆系统后的提示信息"><a href="#11-修改motd，登陆系统后的提示信息" class="headerlink" title="11. 修改motd，登陆系统后的提示信息"></a>11. 修改motd，登陆系统后的提示信息</h2><p>echo “Illegal users are not allowed to login, Only authorized users can login” &gt; /etc/motd<br>当用显示器连接linux主机的时候，屏幕会显示系统版本等相关信息，可以将他取消掉，将/etc/issue和/etc/issue.net改名即可</p>
<h2 id="12-禁用不用的用户和组"><a href="#12-禁用不用的用户和组" class="headerlink" title="12. 禁用不用的用户和组"></a>12. 禁用不用的用户和组</h2><pre>
改/etc/passwd
#adm:x:3:4:adm:/var/adm:/sbin/nologin
#lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
#sync:x:5:0:sync:/sbin:/bin/sync
#shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
#halt:x:7:0:halt:/sbin:/sbin/halt
#uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
#operator:x:11:0:operator:/root:/sbin/nologin
#games:x:12:100:games:/usr/games:/sbin/nologin
#gopher:x:13:30:gopher:/var/gopher:/sbin/nologin
</pre>

<pre>
改/etc/group
#adm:x:4:root,adm,daemon
#lp:x:7:daemon,lp
#uucp:x:14:uucp
#games:x:20:
#dip:x:40:
</pre>

<h2 id="13-禁用没用的服务"><a href="#13-禁用没用的服务" class="headerlink" title="13. 禁用没用的服务"></a>13. 禁用没用的服务</h2><pre>
chkconfig acpid off
chkconfig anacron off
chkconfig auditd off
chkconfig avahi-daemon off
chkconfig autofs off
chkconfig atd off
chkconfig bluetooth off
chkconfig cpuspeed off
chkconfig cups off
chkconfig firstboot off
chkconfig gpm off
chkconfig haldaemon off
chkconfig hidd off
chkconfig ip6tables off
chkconfig iptables off
chkconfig lvm2-monitor off
chkconfig mcstrans off
chkconfig mdmonitor off
chkconfig messagebus off
chkconfig nfslock off
chkconfig pcscd off
chkconfig rawdevices off
chkconfig readahead_early off
chkconfig restorecond off
chkconfig rpcidmapd off
chkconfig sendmail off
chkconfig xfs off
chkconfig yum-updatesd off
chkconfig NetworkManager off
</pre>



      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Kelvin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-77714682-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>