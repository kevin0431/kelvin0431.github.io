<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[测试Hive INT数据类型]]></title>
      <url>https://kevin0431.github.io/2016/07/10/%E6%B5%8B%E8%AF%95Hive-INT%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      <content type="html"><![CDATA[<h1 id="测试HIVE如何处理NUMBER类型数据"><a href="#测试HIVE如何处理NUMBER类型数据" class="headerlink" title="测试HIVE如何处理NUMBER类型数据"></a>测试HIVE如何处理NUMBER类型数据</h1><hr>
<blockquote>
<ul>
<li>以TEST.NUMTEST为例</li>
</ul>
</blockquote>
<ul>
<li>相关资料：</li>
<li><a href="https://docs.oracle.com/cd/E12151_01/doc.150/e12155/oracle_mysql_compared.htm#i1027526" target="_blank" rel="external">Oracle与Mysql数据类型对比</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types#LanguageManualTypes-NumericTypes" target="_blank" rel="external">HIVE官方支持的所有数据类型</a></li>
</ul>
<h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h3><table>
<thead>
<tr>
<th style="text-align:left">Product</th>
<th style="text-align:left">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HDP</td>
<td style="text-align:left">2.4.0.0-169</td>
</tr>
<tr>
<td style="text-align:left">Sqoop</td>
<td style="text-align:left">1.4.6.2.4.0.0-169</td>
</tr>
<tr>
<td style="text-align:left">Hive</td>
<td style="text-align:left">1.2.1000.2.4.0.0-169</td>
</tr>
<tr>
<td style="text-align:left">Oracle</td>
<td style="text-align:left">11g.203</td>
</tr>
</tbody>
</table>
<p>TEST.NUMTEST表结构：<br><img src="http://i.imgur.com/Msu7zWZ.png" alt=""><br><img src="http://i.imgur.com/kUxqVKH.png" alt=""></p>
<p>表内容：<br><img src="http://i.imgur.com/VouhmAR.png" alt=""></p>
<h3 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h3><p>测试出Hive处理NUMBER类型的结果</p>
<h3 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h3><p>1、不进行map-column-hive，直接导入，sqoop语句如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop import --connect <span class="string">'jdbc:oracle:thin:@10.143.90.12:1521:infodb'</span> --username bdc  --password bdc --table TEST.NUMTEST --hive-import --hive-database TEST --hive-table  numtest  --fields-terminated-by <span class="string">"\t"</span> --lines-terminated-by <span class="string">"\n"</span>    --hive-overwrite --delete-target-dir  --hive-drop-import-delims --null-string <span class="string">'\\N'</span> --null-non-string <span class="string">'\\N'</span>  -m 1</span><br></pre></td></tr></table></figure></p>
<p>HIVE处理结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   double                                      </span><br><span class="line">nine                    double                                      </span><br><span class="line">ten                     double                                      </span><br><span class="line">fifteen                 double                                      </span><br><span class="line">nineteen                double                                      </span><br><span class="line">twentytwo               double                                      </span><br><span class="line">Time taken: 0.429 seconds, Fetched: 6 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0.0 1.23456789E8    1.23456789E9    1.23456789123456E14 1.23456789123456794E18  1.2345678901234568E21</span><br><span class="line">10.0    NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.165 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>2、转化规则如下：<br>–map-column-hive THREE=tinyint,FIFTEEN=bigint,TEN=int,NINE=int,TWENTYTWO=bigint,NINETEEN=bigint</p>
<p>HIVE处理结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 bigint                                      </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               bigint                                      </span><br><span class="line">Time taken: 0.427 seconds, Fetched: 6 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  123456789123456 1234567891234567890 NULL</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.089 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>3、单独测试，NUMBER(15)转为INT</p>
<p>HIVE处理结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 int                                         </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               bigint                                      </span><br><span class="line">Time taken: 0.424 seconds, Fetched: 6 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  NULL    1234567891234567890 NULL</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.135 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>4、单独测试，NUMBER(19)转为INT<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 int                                         </span><br><span class="line">nineteen                int                                         </span><br><span class="line">twentytwo               bigint                                      </span><br><span class="line">Time taken: 0.437 seconds, Fetched: 6 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  NULL    NULL    NULL</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.113 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>5、测试NUMBER(22)转为string：<br>–map-column-hive THREE=tinyint,FIFTEEN=bigint,TEN=int,NINE=int,TWENTYTWO=string,NINETEEN=bigint</p>
<p>HIVE结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 bigint                                      </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               string                                      </span><br><span class="line">Time taken: 0.426 seconds, Fetched: 6 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  123456789123456 1234567891234567890 1234567890123456789012</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.132 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>6、测试NUMBER(11)转为INT和BIGINT</p>
<p>INT的HIVE结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 bigint                                      </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               string                                      </span><br><span class="line">eleven                  int                                         </span><br><span class="line">Time taken: 0.43 seconds, Fetched: 7 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  123456789123456 1234567891234567890 1234567890123456789012  NULL</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.1 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>BIGINT的HIVE结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc NUMTEST;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 bigint                                      </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               string                                      </span><br><span class="line">eleven                  bigint                                      </span><br><span class="line">Time taken: 0.426 seconds, Fetched: 7 row(s)</span><br><span class="line">hive&gt; select * from NUMTEST;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  123456789123456 1234567891234567890 1234567890123456789012  12345678901</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL    NULL</span><br><span class="line">Time taken: 0.132 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>7、测试NUMBER无长度，无精度类型，需要转成string</p>
<p>Hive的结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc numtest;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 bigint                                      </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               string                                      </span><br><span class="line">eleven                  bigint                                      </span><br><span class="line">aa                      string                                      </span><br><span class="line">bb                      double                                      </span><br><span class="line">Time taken: 0.425 seconds, Fetched: 9 row(s)</span><br><span class="line">hive&gt; select * from  numtest;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  123456789123456 1234567891234567890 1234567890123456789012  12345678901 123456789012345 1.234567812E7</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL    NULL    123.99  NULL</span><br><span class="line">Time taken: 0.176 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<p>8、双精度double类型，转成string<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc numtest;</span><br><span class="line">OK</span><br><span class="line">three                   tinyint                                     </span><br><span class="line">nine                    int                                         </span><br><span class="line">ten                     int                                         </span><br><span class="line">fifteen                 bigint                                      </span><br><span class="line">nineteen                bigint                                      </span><br><span class="line">twentytwo               string                                      </span><br><span class="line">eleven                  bigint                                      </span><br><span class="line">aa                      string                                      </span><br><span class="line">bb                      string                                      </span><br><span class="line">Time taken: 0.553 seconds, Fetched: 9 row(s)</span><br><span class="line">hive&gt; select * from  numtest;</span><br><span class="line">OK</span><br><span class="line">0   123456789   1234567890  123456789123456 1234567891234567890 1234567890123456789012  12345678901 123456789012345 12345678.12</span><br><span class="line">10  NULL    NULL    NULL    NULL    NULL    NULL    123.99  NULL</span><br><span class="line">Time taken: 0.162 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure></p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><strong>HIVE转化Oracle的NUMBER数据类型结论如下：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Orace数据类型</th>
<th style="text-align:left">Hive数据类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">NUMBER(1)~NUMBER(3)</td>
<td style="text-align:left">TINYINT</td>
</tr>
<tr>
<td style="text-align:left">NUMBER(4)~NUMBER(10)</td>
<td style="text-align:left">INT</td>
</tr>
<tr>
<td style="text-align:left">NUMBER(11)~NUMBER(19)</td>
<td style="text-align:left">BIGINT</td>
</tr>
<tr>
<td style="text-align:left">NUMBER(20)以上</td>
<td style="text-align:left">STRING</td>
</tr>
</tbody>
</table>
<p><strong>HIVE数据类型转换</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">所有类型</th>
<th style="text-align:center">BOOLEAN</th>
<th style="text-align:center">TINYINT</th>
<th style="text-align:center">SMALLINT</th>
<th style="text-align:center">INT</th>
<th style="text-align:center">BIGINT</th>
<th style="text-align:center">FLOAT</th>
<th style="text-align:center">DOUBLE</th>
<th style="text-align:center">DECIMAL</th>
<th style="text-align:center">STRING</th>
<th style="text-align:center">VARCHAR</th>
<th style="text-align:center">TIMESTAMP</th>
<th style="text-align:center">DATE</th>
<th style="text-align:center">BINARY</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">BOOLEAN</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">TINYINT</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">INT</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">FLOAT</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">DECIMAL</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">STRING</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">VARCHAR</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">TIMESTAMP</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">DATE</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:left">BINARY</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
</tr>
</tbody>
</table>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[自定义Ambari Alerts]]></title>
      <url>https://kevin0431.github.io/2016/06/20/%E8%87%AA%E5%AE%9A%E4%B9%89Ambari-Alerts/</url>
      <content type="html"><![CDATA[<h1 id="Update-thresholds-for-the-Ambari-alert"><a href="#Update-thresholds-for-the-Ambari-alert" class="headerlink" title="Update thresholds for the Ambari alert"></a>Update thresholds for the Ambari alert</h1><hr>
<blockquote>
<ul>
<li>以Host Disk Usage为例</li>
</ul>
</blockquote>
<h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h3><table>
<thead>
<tr>
<th style="text-align:left">Product</th>
<th style="text-align:left">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Ambari</td>
<td style="text-align:left">2.2.1.0-169</td>
</tr>
<tr>
<td style="text-align:left">HDP</td>
<td style="text-align:left">2.4.0.0-169</td>
</tr>
</tbody>
</table>
<h3 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h3><p>修改Host Disk Usage warning value，默认50%</p>
<h3 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h3><p>1、找到集群名字<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@gmjk-dsj8 ~]<span class="comment"># curl --user admin:admin http://localhost:8080/api/v1/clusters/</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"href"</span> : <span class="string">"http://localhost:8080/api/v1/clusters/"</span>,</span><br><span class="line">  <span class="string">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"href"</span> : <span class="string">"http://localhost:8080/api/v1/clusters/test"</span>,</span><br><span class="line">      <span class="string">"Clusters"</span> : &#123;</span><br><span class="line">        <span class="string">"cluster_name"</span> : <span class="string">"test"</span>,</span><br><span class="line">        <span class="string">"version"</span> : <span class="string">"HDP-2.4"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2、输出集群所有配置<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@gmjk</span>-dsj8 ~]<span class="comment"># curl --user admin:admin http://localhost:8080/api/v1/clusters/test &gt; /root/0620</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">100</span>  <span class="number">885</span>k    <span class="number">0</span>  <span class="number">885</span>k    <span class="number">0</span>     <span class="number">0</span>  <span class="number">2475</span>k      <span class="number">0</span> --<span class="symbol">:--</span><span class="symbol">:--</span> --<span class="symbol">:--</span><span class="symbol">:--</span> --<span class="symbol">:--</span><span class="symbol">:--</span> <span class="number">2488</span>k</span><br></pre></td></tr></table></figure></p>
<p>3、找到Host Disk Usage配置，URL应该是<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/gmjk-dsj8:8080/api</span><span class="regexp">/v1/clusters</span><span class="regexp">/test/alert</span>_definitions/<span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p>4、查看Host Disk Usage配置细节<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@gmjk-dsj8 ~]<span class="comment"># curl -u admin:admin -X GET http://gmjk-dsj8:8080/api/v1/clusters/test/alert_definitions/3</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"href"</span> : <span class="string">"http://gmjk-dsj8:8080/api/v1/clusters/test/alert_definitions/3"</span>,</span><br><span class="line">  <span class="string">"AlertDefinition"</span> : &#123;</span><br><span class="line">    <span class="string">"cluster_name"</span> : <span class="string">"test"</span>,</span><br><span class="line">    <span class="string">"component_name"</span> : <span class="string">"AMBARI_AGENT"</span>,</span><br><span class="line">    <span class="string">"description"</span> : <span class="string">"This host-level alert is triggered if the amount of disk space used goes above specific thresholds. The default threshold values are 70% for WARNING and 80% for CRITICAL"</span>,</span><br><span class="line">    <span class="string">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"id"</span> : 3,</span><br><span class="line">    <span class="string">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"interval"</span> : 1,</span><br><span class="line">    <span class="string">"label"</span> : <span class="string">"Host Disk Usage"</span>,</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"ambari_agent_disk_usage"</span>,</span><br><span class="line">    <span class="string">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">    <span class="string">"service_name"</span> : <span class="string">"AMBARI"</span>,</span><br><span class="line">    <span class="string">"source"</span> : &#123;</span><br><span class="line">      <span class="string">"parameters"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"display_name"</span> : <span class="string">"Minimum Free Space"</span>,</span><br><span class="line">          <span class="string">"description"</span> : <span class="string">"The overall amount of free disk space left before an alert is triggered."</span>,</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"minimum.free.space"</span>,</span><br><span class="line">          <span class="string">"value"</span> : <span class="string">"5.0E9"</span>,</span><br><span class="line">          <span class="string">"type"</span> : <span class="string">"NUMERIC"</span>,</span><br><span class="line">          <span class="string">"units"</span> : <span class="string">"bytes"</span>,</span><br><span class="line">          <span class="string">"threshold"</span> : <span class="string">"WARNING"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"display_name"</span> : <span class="string">"Warning"</span>,</span><br><span class="line">          <span class="string">"description"</span> : <span class="string">"The percent of disk space consumed before a warning is triggered."</span>,</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"percent.used.space.warning.threshold"</span>,</span><br><span class="line">          <span class="string">"value"</span> : <span class="string">"0.7"</span>,</span><br><span class="line">          <span class="string">"type"</span> : <span class="string">"PERCENT"</span>,</span><br><span class="line">          <span class="string">"units"</span> : <span class="string">"%"</span>,</span><br><span class="line">          <span class="string">"threshold"</span> : <span class="string">"WARNING"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"display_name"</span> : <span class="string">"Critical"</span>,</span><br><span class="line">          <span class="string">"description"</span> : <span class="string">"The percent of disk space consumed before a critical alert is triggered."</span>,</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"percent.free.space.critical.threshold"</span>,</span><br><span class="line">          <span class="string">"value"</span> : <span class="string">"0.8"</span>,</span><br><span class="line">          <span class="string">"type"</span> : <span class="string">"PERCENT"</span>,</span><br><span class="line">          <span class="string">"units"</span> : <span class="string">"%"</span>,</span><br><span class="line">          <span class="string">"threshold"</span> : <span class="string">"CRITICAL"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"path"</span> : <span class="string">"alert_disk_space.py"</span>,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"SCRIPT"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5、拷贝以上输出，去掉”href”行，修改需要的value和Description</p>
<p>6、上传修改后的JSON，注意 PUT -d 后的单引号<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@gmjk-dsj8 ~]<span class="comment"># curl -u admin:admin -H 'X-Requested-By:admin' -X PUT  -d '&#123;</span></span><br><span class="line">&gt;   <span class="string">"AlertDefinition"</span> : &#123;</span><br><span class="line">&gt;     <span class="string">"cluster_name"</span> : <span class="string">"test"</span>,</span><br><span class="line">&gt;     <span class="string">"component_name"</span> : <span class="string">"AMBARI_AGENT"</span>,</span><br><span class="line">&gt;     <span class="string">"description"</span> : <span class="string">"This host-level alert is triggered if the amount of disk space used goes above specific thresholds. The default threshold values are 70% for WARNING and 80% for CRITICAL"</span>,</span><br><span class="line">&gt;     <span class="string">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">&gt;     <span class="string">"id"</span> : 3,</span><br><span class="line">&gt;     <span class="string">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">&gt;     <span class="string">"interval"</span> : 1,</span><br><span class="line">&gt;     <span class="string">"label"</span> : <span class="string">"Host Disk Usage"</span>,</span><br><span class="line">&gt;     <span class="string">"name"</span> : <span class="string">"ambari_agent_disk_usage"</span>,</span><br><span class="line">&gt;     <span class="string">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">&gt;     <span class="string">"service_name"</span> : <span class="string">"AMBARI"</span>,</span><br><span class="line">&gt;     <span class="string">"source"</span> : &#123;</span><br><span class="line">&gt;       <span class="string">"parameters"</span> : [</span><br><span class="line">&gt;         &#123;</span><br><span class="line">&gt;           <span class="string">"name"</span> : <span class="string">"minimum.free.space"</span>,</span><br><span class="line">&gt;           <span class="string">"display_name"</span> : <span class="string">"Minimum Free Space"</span>,</span><br><span class="line">&gt;           <span class="string">"units"</span> : <span class="string">"bytes"</span>,</span><br><span class="line">&gt;           <span class="string">"value"</span> : 5.0E9,</span><br><span class="line">&gt;           <span class="string">"description"</span> : <span class="string">"The overall amount of free disk space left before an alert is triggered."</span>,</span><br><span class="line">&gt;           <span class="string">"type"</span> : <span class="string">"NUMERIC"</span>,</span><br><span class="line">&gt;           <span class="string">"threshold"</span> : <span class="string">"WARNING"</span></span><br><span class="line">&gt;         &#125;,</span><br><span class="line">&gt;         &#123;</span><br><span class="line">&gt;           <span class="string">"name"</span> : <span class="string">"percent.used.space.warning.threshold"</span>,</span><br><span class="line">&gt;           <span class="string">"display_name"</span> : <span class="string">"Warning"</span>,</span><br><span class="line">&gt;           <span class="string">"units"</span> : <span class="string">"%"</span>,</span><br><span class="line">&gt;           <span class="string">"value"</span> : 0.7,</span><br><span class="line">&gt;           <span class="string">"description"</span> : <span class="string">"The percent of disk space consumed before a warning is triggered."</span>,</span><br><span class="line">&gt;           <span class="string">"type"</span> : <span class="string">"PERCENT"</span>,</span><br><span class="line">&gt;           <span class="string">"threshold"</span> : <span class="string">"WARNING"</span></span><br><span class="line">&gt;         &#125;,</span><br><span class="line">&gt;         &#123;</span><br><span class="line">&gt;           <span class="string">"name"</span> : <span class="string">"percent.free.space.critical.threshold"</span>,</span><br><span class="line">&gt;           <span class="string">"display_name"</span> : <span class="string">"Critical"</span>,</span><br><span class="line">&gt;           <span class="string">"units"</span> : <span class="string">"%"</span>,</span><br><span class="line">&gt;           <span class="string">"value"</span> : 0.8,</span><br><span class="line">&gt;           <span class="string">"description"</span> : <span class="string">"The percent of disk space consumed before a critical alert is triggered."</span>,</span><br><span class="line">&gt;           <span class="string">"type"</span> : <span class="string">"PERCENT"</span>,</span><br><span class="line">&gt;           <span class="string">"threshold"</span> : <span class="string">"CRITICAL"</span></span><br><span class="line">&gt;         &#125;</span><br><span class="line">&gt;       ],</span><br><span class="line">&gt;       <span class="string">"path"</span> : <span class="string">"alert_disk_space.py"</span>,</span><br><span class="line">&gt;       <span class="string">"type"</span> : <span class="string">"SCRIPT"</span></span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt; &#125;<span class="string">' http://gmjk-dsj8:8080/api/v1/clusters/test/alert_definitions/3</span></span><br></pre></td></tr></table></figure></p>
<p>7、检查修改后的监控项<br><img src="http://i.imgur.com/t9IlzDf.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hadoop重新做HA]]></title>
      <url>https://kevin0431.github.io/2016/06/05/Hadoop%E9%87%8D%E6%96%B0%E5%81%9AHA/</url>
      <content type="html"><![CDATA[<h2 id="1、首先在Active上执行以下命令，手动备份整个name目录："><a href="#1、首先在Active上执行以下命令，手动备份整个name目录：" class="headerlink" title="1、首先在Active上执行以下命令，手动备份整个name目录："></a>1、首先在Active上执行以下命令，手动备份整个name目录：</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#关闭故障自动控制器</span></span><br><span class="line">hadoop-daemon.sh stop zkfs</span><br><span class="line"></span><br><span class="line"><span class="meta">#进入安全模式</span></span><br><span class="line">hdfs dfsadmin -safemode enter</span><br><span class="line"></span><br><span class="line"><span class="meta">#刷新editslog到fsimage</span></span><br><span class="line">hdfs dfsadmin -saveNamespace</span><br></pre></td></tr></table></figure>
<h2 id="2、在Standby上备份整个name和journal目录，在执行："><a href="#2、在Standby上备份整个name和journal目录，在执行：" class="headerlink" title="2、在Standby上备份整个name和journal目录，在执行："></a>2、在Standby上备份整个name和journal目录，在执行：</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop-daemon<span class="selector-class">.sh</span> stop zkfc</span><br><span class="line">hdfs namenode -bootstrapStandby</span><br></pre></td></tr></table></figure>
<p>若报以下错：<br><strong>FATAL ha.BootstrapStandby: Unable to read transaction ids 10-100 from the configured shared edits storage qjournal://1.1.1.1:8485;1.1.1.2:8485/sec-hdfs-cluster. Please copy these logs into the shared edits storage or call saveNamespace on the active node.<br>Error: Gap in transactions. Expected to be able to read up until at least txid 10 but unable to find any edit logs containing txid 10</strong></p>
<p>需要将Active整个name目录复制到Standby，然后启动namenode：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /data/hadoop/name <span class="variable">$standby_ip</span><span class="symbol">:/data/hadoop</span></span><br><span class="line">hadoop-daemon.sh start namenode</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS安装加固总结]]></title>
      <url>https://kevin0431.github.io/2016/05/15/Centos%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<blockquote>
<ul>
<li>要更新的软件：<br>bash，openssl，glibc</li>
</ul>
</blockquote>
<h2 id="配置密码不允许重复次数和复杂度"><a href="#配置密码不允许重复次数和复杂度" class="headerlink" title="配置密码不允许重复次数和复杂度"></a>配置密码不允许重复次数和复杂度</h2><pre>
#编辑/etc/pam.d/system-auth文件，找到以下行：
password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok
#后面添加  remember=3  代表不允许使用之前3次用过的密码
</pre>

<pre>
#找到以下行
password    requisite     pam_cracklib.so try_first_pass retry=3 type=

修改为：
password    requisite     pam_cracklib.so try_first_pass retry=6 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1
#retry=N 重试N次后返回密码错误
#difok=N 新密码必需与旧密码不同的位数
#dcredit=N N>=0表示密码最多N个数字，反之最少N个数字
#lcredit=N 小写字母个数
#ucredit=N 小写字母个数
#ccredit=N 小写字母个数
#minclass=N 密码组成(大/小字母,数字,特殊字符)
#root不受此限制，普通用户登录后改密码才受限制
</pre>

<h2 id="禁止root登录"><a href="#禁止root登录" class="headerlink" title="禁止root登录"></a>禁止root登录</h2><pre>
#更改/etc/ssh/sshd_config，之后重启sshd
PermitRootLogin yes
改成：PermitRootLogin no
</pre>

<h2 id="修改密码长度和过期时间："><a href="#修改密码长度和过期时间：" class="headerlink" title="修改密码长度和过期时间："></a>修改密码长度和过期时间：</h2><pre>
#改 /etc/login.defs
PASS_MAX_DAYS   90
PASS_MIN_DAYS   1
PASS_MIN_LEN    9
PASS_WARN_AGE   7
解释：
# PASS_MAX_DAYS   密码使用的最长期限
# PASS_MIN_DAYS   密码允许更改的最短期限
# PASS_MIN_LEN    能接受的密码最短长度
# PASS_WARN_AGE   密码过期之前的提醒天数
</pre>

<h2 id="设置连续失败次数和失败锁定时间"><a href="#设置连续失败次数和失败锁定时间" class="headerlink" title="设置连续失败次数和失败锁定时间"></a>设置连续失败次数和失败锁定时间</h2><p>修改(/etc/pam.d/system-auth和/etc/pam.d/sshd)分别在开始位置加入以下内容：</p>
<pre>
auth    required    pam_tally2.so    deny=6    unlock_time=300    even_deny_root root_unlock_time=120
#最大失败次数6次，超过6次锁定300s，root用户锁定120s
#两个文件中"required pam_tally2.so deny"要删掉
</pre>

<h2 id="umask降权，设置历史命令数"><a href="#umask降权，设置历史命令数" class="headerlink" title="umask降权，设置历史命令数"></a>umask降权，设置历史命令数</h2><p>默认uid&gt;199的umask是022，uid&lt;199的umask是022，可以在/etc/profile里新加一行”umask 027”，修改HISSIZE=100，即最大历史命令是100</p>
<h2 id="修改ssh-banner"><a href="#修改ssh-banner" class="headerlink" title="修改ssh banner"></a>修改ssh banner</h2><p>自定义banner文件：echo “Only Gomeholdings users can login” &gt; /etc/ssh/gomebanner<br>再修改/etc/ssh/sshd_config 新增”Banner /etc/ssh/gomebanner”</p>
<h2 id="修改ssh访问控制"><a href="#修改ssh访问控制" class="headerlink" title="修改ssh访问控制"></a>修改ssh访问控制</h2><p>/etc/hosts.allow文件<br>如： sshd:10.35.0.0/255.255.0.0<br>禁止访问的文件 /etc/hosts.deny    sshd:all<br>hosts.allow文件优先</p>
<h2 id="空闲超时退出"><a href="#空闲超时退出" class="headerlink" title="空闲超时退出"></a>空闲超时退出</h2><p>改/etc/profile 追加 TMOUT=300</p>
<h2 id="su限制"><a href="#su限制" class="headerlink" title="su限制"></a>su限制</h2><p>修改/etc/login.defs 追加”SU_WHEEL_ONLY yes”<br>修改/etc/pam.d/su<br>将”auth        required    pam_wheel.so use_uid”取消注释<br>将要配置su权限的用户加到wheel组：<br>usermod -G wheel work</p>
<h2 id="取消CTRL-ALT-DELETE"><a href="#取消CTRL-ALT-DELETE" class="headerlink" title="取消CTRL+ALT+DELETE"></a>取消CTRL+ALT+DELETE</h2><p>修改/etc/init/control-alt-delete.conf，注释掉以下内容：<br>start on control-alt-delete<br>exec /sbin/shutdown -r now “Control-Alt-Delete pressed”</p>
<p>对于Centos7只需：rm -rf /usr/lib/systemd/ctrl-alt-del.target</p>
<h2 id="修改motd，登陆系统后的提示信息"><a href="#修改motd，登陆系统后的提示信息" class="headerlink" title="修改motd，登陆系统后的提示信息"></a>修改motd，登陆系统后的提示信息</h2><p>echo “Illegal users are not allowed to login, Only authorized users can login” &gt; /etc/motd<br>当用显示器连接linux主机的时候，屏幕会显示系统版本等相关信息，可以将他取消掉，将/etc/issue和/etc/issue.net改名即可</p>
<h2 id="禁用不用的用户和组"><a href="#禁用不用的用户和组" class="headerlink" title="禁用不用的用户和组"></a>禁用不用的用户和组</h2><pre>
改/etc/passwd
#adm:x:3:4:adm:/var/adm:/sbin/nologin
#lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
#sync:x:5:0:sync:/sbin:/bin/sync
#shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
#halt:x:7:0:halt:/sbin:/sbin/halt
#uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
#operator:x:11:0:operator:/root:/sbin/nologin
#games:x:12:100:games:/usr/games:/sbin/nologin
#gopher:x:13:30:gopher:/var/gopher:/sbin/nologin
</pre>

<pre>
改/etc/group
#adm:x:4:root,adm,daemon
#lp:x:7:daemon,lp
#uucp:x:14:uucp
#games:x:20:
#dip:x:40:
</pre>

<h2 id="禁用没用的服务"><a href="#禁用没用的服务" class="headerlink" title="禁用没用的服务"></a>禁用没用的服务</h2><pre>
chkconfig acpid off
chkconfig anacron off
chkconfig auditd off
chkconfig avahi-daemon off
chkconfig autofs off
chkconfig atd off
chkconfig bluetooth off
chkconfig cpuspeed off
chkconfig cups off
chkconfig firstboot off
chkconfig gpm off
chkconfig haldaemon off
chkconfig hidd off
chkconfig ip6tables off
chkconfig iptables off
chkconfig lvm2-monitor off
chkconfig mcstrans off
chkconfig mdmonitor off
chkconfig messagebus off
chkconfig nfslock off
chkconfig pcscd off
chkconfig rawdevices off
chkconfig readahead_early off
chkconfig restorecond off
chkconfig rpcidmapd off
chkconfig sendmail off
chkconfig xfs off
chkconfig yum-updatesd off
chkconfig NetworkManager off
</pre>


]]></content>
    </entry>
    
  
  
</search>
